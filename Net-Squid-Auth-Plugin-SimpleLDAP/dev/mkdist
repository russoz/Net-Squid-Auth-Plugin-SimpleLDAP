# Make README
( cd lib; perldoc -t -F Net/Squid/Auth/Plugin/SimpleLDAP.pm > ../README ) 
git add README

perl ./Build.PL && ./Build distmeta

version=$(perl -nle 'if( /^version/ ) { s/^\S+\s+//; print; }' META.yml)
git add META.yml

# Generate Changes automagically:
cp Changes __changes && {
    echo "Revision history for Net-Squid-Auth-Plugin-SimpleLDAP"
    echo ""
    v=$(echo $version | sed -e 's/^v//') 
    printf '%-7s %s\n' "$v" "$(date +%d.%m.%Y)"
    git log --oneline | perl -nle 'next if /DIST VERSION '"$version"'/; exit if /DIST VERSION/; print "        $_";' &&
    echo "" &&
    cat __changes | perl -e '$a=<>; $a=<>; while(<>) { print }'
} > Changes
git add Changes

git commit -m "DIST VERSION $version"

./Build dist && mv Net-Squid-Auth-Plugin-SimpleLDAP*.tar.gz ${HOME}

git clean -fd
